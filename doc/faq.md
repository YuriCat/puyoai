# FAQ

AIに関してよく聞かれる質問及び回答をまとめました。

注：フレームという単位は1/60秒を指します。

## 基本

* どのように動いているのですか？


1. ゲーム映像をビデオキャプチャで取得し、画面を解析します。
  * Wii版の場合、Wiiから出ている映像信号を分岐して用います。
  * アーケード版の場合、基板と筐体をつないでいるハーネスから映像信号を取り出します。
2. 別プロセスで動いているAIに、解析した画面の結果を渡します。
  * フレームごとに解析情報を毎回渡しています。
  * 解析情報には、NEXT2が見えた、おじゃまが降ったなど、フレームワーク側でいくつか付加情報を付与しています。
3. AIが思考し、どこにぷよを落としたいのかを決定します。
4. そこにぷよを落とすためのキー操作列をフレームワーク側で生成し、キー入力を実機に送ります。
  * Wii版、アーケード版とも、Arduinoを使っています。
    * 詳しい人向け: ArduinoとPCの通信は、シリアル通信を用いています。
  * Wii版の場合、ArduinoにWii拡張コントローラーのふりをさせることができます。押したボタンをWiiリモコンに送ることで、操作をさせています。
    * 詳しい人向け: WiiリモコンとWii拡張コントローラーは暗号化したI2C通信がなされています。
    * ただすでに暗号が解析されていて、その成果物を利用しています。 https://github.com/denizkoekden/arduino-wiimote
  * アーケード版の場合、ハーネスにボタンの線がありますので、Arduinoを用いて電気的にボタンを押しています。
    * 詳しい人向け: ボタンは5Vが来ていて、1kΩ抵抗でプルアップされています。単純にGNDに接続すればボタンが押せたことになります。

本体および基板には一切の改造を施していません。

## 映像

* 13段目は見えているのですか？

見えていません。AIは適当に推測をしています。

## 思考

* どのように思考しているのですか？

ぷよの置き方を全通り試し、なんらかの評価値をつけ、その評価値がもっとも高い置き方を選ぶ、という方法で思考をします。

置き方を試す場合、ぷよぷよ通では、今操作しているぷよ、NEXTおよびNEXT2の3つの組ぷよまでがみられます。
この全ての組み合わせを試すことができそうですが、ぷよがフィールドに現れて操作可能になった瞬間はNEXT2は見えていません。
NEXT2は、現在のぷよが操作可能になってから16フレーム遅延してはじめて見られるようになります。
そのため、NEXT2の情報は実質的には使えません。したがって、
現在操作可能なぷよ及びNEXTの置き方を全通り試して思考します。ただし実際には、NEXT2が見えた瞬間にNEXTをどこに置くかを考えています。
NEXT2が見えた後でNEXTが操作可能になるまでには20フレーム程度の余裕があり、その間に思考をしています。

  * ツモ予見は使っていますか？

使っています。

ツモ予見とは、相手の方が自分よりも高速にぷよを積んでいる場合、相手の配ぷよを見ることでNEXT2以降のツモがわかること、と定義します。
フレームワーク側で、予見できるツモ全てをAIに送るようにしています。ただし、4手後以降を探索することは、思考時間がかかりすぎるためにAIにとっては現実的ではないです。

* 評価のつけ方はどのようにするのでしょうか？

これはAIによって異なるため、難しい質問です。
基本的には、大きな連鎖を組むことができれば高評価ですが、速攻型・潰し型を作ろうと思えば大きな連鎖は高評価にはならないでしょう。

* どれぐらい連鎖を組めますか？

AIによって異なりますので、mayah(AI)の話をします。2手(動かしているぷよ、NEXT)の情報だけを使って連鎖を組んだ場合、中央値が大体80000点です。
つまり、2回に1回は80000点程度の連鎖を打てる、ということです。3手の場合は85000点です。あとCPUが6倍ぐらい速ければ(12コア程度のマシンが使えれば)、
3手読みで95000までいけることも分かっています。

## 定石 (定積)

* GTRなどの定形は組みますか？

mayah(AI)は定積ファイルを持っており、パターンマッチングを行なって定積型に高評価を与えています。
パターンマッチングとは、定積ファイルに書かれた定積のパターンと実際のフィールドを照らし合わせ、実際のフィールドがパターンにあっているかどうかを調べることです。
これはなるべく人間らしい積みをさせるためでもありますが、土台を安定させることによってより大きな連鎖を組むことができることが分かったので採用しました。

AIは端の列を使うのが苦手です。端列の方が受けが狭いので、受けの広い真ん中に積むことを優先してしまいがちだからです。
定積を教えると簡単に端列の使い方を教えることができるため、より効率の良い積みができるようになります。
もちろん、定積なしでより効率的な積み方を教えることができれば最高なのですが、まだ実現できていません。

mayah(AI)のパターンは連鎖の部分形からできており、複数のパターンを連鎖的に組み合わせながら評価を行ないます。
これがmayah(AI)の最も特徴的なところだと思います。この連鎖的に組み合わせるというアイデアは、AIを強くするブレークスルーの1つでした。

* 弥生は組みますか？

mayah(AI)は組みます。
