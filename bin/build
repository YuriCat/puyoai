#!/bin/zsh

declare -a cmake_opts
cmake_opts+=("-GNinja")
cmake_opts+=("-DCMAKE_C_COMPILER=clang")
cmake_opts+=("-DCMAKE_CXX_COMPILER=clang++")
cmake_opts+=("-DCMAKE_BUILD_TYPE=Debug")

declare -a cmake_cxx_flags
cmake_cxx_flags+=("-std=gnu++11" "-Werror" "-Wall" "-Wextra")
cmake_cxx_flags+=("-Wno-error=unused-variable" "-Wno-error=unused-parameter")
cmake_cxx_flags+=("-Wno-error=missing-field-initializers")
cmake_cxx_flags+=("-fsanitize=address")
cmake_cxx_flags+=("-O2")

cmake_opts+=("-DCMAKE_CXX_FLAGS=${cmake_cxx_flags[*]}")

cd "$(dirname "$0")/.."
mkdir -p build
cd build
cmake "${cmake_opts[@]}" "../src"
ninja "$@"
